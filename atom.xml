<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2019-06-21T05:31:00.231Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Yi Li</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>avx512</title>
    <link href="http://yoursite.com/2019/06/21/avx512/"/>
    <id>http://yoursite.com/2019/06/21/avx512/</id>
    <published>2019-06-21T05:31:00.000Z</published>
    <updated>2019-06-21T05:31:00.231Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>kaggle</title>
    <link href="http://yoursite.com/2019/06/21/kaggle/"/>
    <id>http://yoursite.com/2019/06/21/kaggle/</id>
    <published>2019-06-21T05:30:47.000Z</published>
    <updated>2019-06-21T05:30:47.787Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>git</title>
    <link href="http://yoursite.com/2019/06/21/git/"/>
    <id>http://yoursite.com/2019/06/21/git/</id>
    <published>2019-06-21T05:29:35.000Z</published>
    <updated>2019-06-21T05:29:35.487Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>etcd</title>
    <link href="http://yoursite.com/2019/06/21/etcd/"/>
    <id>http://yoursite.com/2019/06/21/etcd/</id>
    <published>2019-06-21T05:29:24.000Z</published>
    <updated>2019-06-21T05:29:24.915Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>docker</title>
    <link href="http://yoursite.com/2019/06/21/docker/"/>
    <id>http://yoursite.com/2019/06/21/docker/</id>
    <published>2019-06-21T05:29:09.000Z</published>
    <updated>2019-06-21T05:29:09.132Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>xgboost</title>
    <link href="http://yoursite.com/2019/06/21/xgboost/"/>
    <id>http://yoursite.com/2019/06/21/xgboost/</id>
    <published>2019-06-21T05:22:25.000Z</published>
    <updated>2019-06-21T05:24:56.653Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="boosting" scheme="http://yoursite.com/tags/boosting/"/>
    
  </entry>
  
  <entry>
    <title>LR</title>
    <link href="http://yoursite.com/2019/06/21/LR/"/>
    <id>http://yoursite.com/2019/06/21/LR/</id>
    <published>2019-06-21T05:21:42.000Z</published>
    <updated>2019-06-21T05:23:59.986Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="ML" scheme="http://yoursite.com/tags/ML/"/>
    
  </entry>
  
  <entry>
    <title>IF</title>
    <link href="http://yoursite.com/2019/06/21/IF/"/>
    <id>http://yoursite.com/2019/06/21/IF/</id>
    <published>2019-06-21T05:21:28.000Z</published>
    <updated>2019-06-21T05:23:45.733Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="Isolate Forest" scheme="http://yoursite.com/tags/Isolate-Forest/"/>
    
      <category term="Desion Tree" scheme="http://yoursite.com/tags/Desion-Tree/"/>
    
  </entry>
  
  <entry>
    <title>gdbt</title>
    <link href="http://yoursite.com/2019/06/21/gdbt/"/>
    <id>http://yoursite.com/2019/06/21/gdbt/</id>
    <published>2019-06-21T05:21:13.000Z</published>
    <updated>2019-06-21T05:23:16.407Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="Desicion Tree" scheme="http://yoursite.com/tags/Desicion-Tree/"/>
    
  </entry>
  
  <entry>
    <title>RF</title>
    <link href="http://yoursite.com/2019/06/21/RF/"/>
    <id>http://yoursite.com/2019/06/21/RF/</id>
    <published>2019-06-21T05:20:17.000Z</published>
    <updated>2019-06-21T05:24:39.514Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="ML" scheme="http://yoursite.com/tags/ML/"/>
    
      <category term="boosting" scheme="http://yoursite.com/tags/boosting/"/>
    
  </entry>
  
  <entry>
    <title>LSTM</title>
    <link href="http://yoursite.com/2019/06/21/LSTM/"/>
    <id>http://yoursite.com/2019/06/21/LSTM/</id>
    <published>2019-06-21T05:19:19.000Z</published>
    <updated>2019-06-21T05:24:16.267Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="ML" scheme="http://yoursite.com/tags/ML/"/>
    
      <category term="NLP" scheme="http://yoursite.com/tags/NLP/"/>
    
  </entry>
  
  <entry>
    <title>EM</title>
    <link href="http://yoursite.com/2019/06/21/EM/"/>
    <id>http://yoursite.com/2019/06/21/EM/</id>
    <published>2019-06-21T05:18:59.000Z</published>
    <updated>2019-06-21T05:22:53.411Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="ML" scheme="http://yoursite.com/tags/ML/"/>
    
      <category term="Bayesian" scheme="http://yoursite.com/tags/Bayesian/"/>
    
  </entry>
  
  <entry>
    <title>prometheus</title>
    <link href="http://yoursite.com/2019/06/21/prometheus/"/>
    <id>http://yoursite.com/2019/06/21/prometheus/</id>
    <published>2019-06-21T05:14:21.000Z</published>
    <updated>2019-06-24T03:03:10.943Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Prometheus-start-by-docker"><a href="#Prometheus-start-by-docker" class="headerlink" title="Prometheus start by docker"></a>Prometheus start by docker</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9090:9090 --name prometheus  -d -v /home/li/Downloads/prom/Prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus</span><br></pre></td></tr></table></figure><h2 id="设置mount"><a href="#设置mount" class="headerlink" title="设置mount"></a>设置mount</h2><p> -v 将local <em>Promethus.yml</em> 和 <em>/etc/prometheus/prometheus.yml</em> 文件挂载</p><p> 这样可以custom configure local pro.yml </p><ul><li><p>for example 设置</p><p> 一个 target 来源为json file<br> <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#file_sd_config" target="_blank" rel="noopener">https://prometheus.io/docs/prometheus/latest/configuration/configuration/#file_sd_config</a></p></li></ul><ul><li>for example 设置static<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">       │ File: Prometheus.yml</span><br><span class="line">───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">   1   │ # my global config</span><br><span class="line">   2   │ global:</span><br><span class="line">   3   │   scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br><span class="line">   4   │   evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.</span><br><span class="line">   5   │   # scrape_timeout is set to the global default (10s).</span><br><span class="line">   6   │</span><br><span class="line">   7   │ # Alertmanager configuration</span><br><span class="line">   8   │ alerting:</span><br><span class="line">   9   │   alertmanagers:</span><br><span class="line">  10   │   - static_configs:</span><br><span class="line">  11   │     - targets:</span><br><span class="line">  12   │       # - alertmanager:9093</span><br><span class="line">  13   │</span><br><span class="line">  14   │ # Load rules once and periodically evaluate them according to the global &apos;evaluation_interval&apos;.</span><br><span class="line">  15   │ rule_files:</span><br><span class="line">  16   │   # - &quot;first_rules.yml&quot;</span><br><span class="line">  17   │   # - &quot;second_rules.yml&quot;</span><br><span class="line">  18   │</span><br><span class="line">  19   │ # A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line">  20   │ # Here it&apos;s Prometheus itself.</span><br><span class="line">  21   │ scrape_configs:</span><br><span class="line">  22   │   # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  23   │   - job_name: &apos;prometheusyl&apos;</span><br><span class="line">  24   │</span><br><span class="line">  25   │     # metrics_path defaults to &apos;/metrics&apos;        #metric的路径默认就是&apos;/metrics&apos;</span><br><span class="line">  26   │     # scheme defaults to &apos;http&apos;.</span><br><span class="line">  27   │</span><br><span class="line">  28   │     static_configs:                              </span><br><span class="line">  29   │         - targets: [&apos;10.239.157.138:7071&apos;]</span><br><span class="line">  30   │   - job_name: &apos;test-prometheus-from-yl&apos;           #1. 先设置job名</span><br><span class="line">  31   │</span><br><span class="line">  32   │     metrics_path: /                               #2. 可以自定义metric路径</span><br><span class="line">  33   │</span><br><span class="line">  34   │     static_configs:                               #3. 配置的方式，例如static，file</span><br><span class="line">  35   │         - targets: [&apos;10.239.157.141:8001&apos;]        #4. scrap目标来源，也就是将metric暴露给http的端口地址</span><br><span class="line">  36   │</span><br><span class="line">  37   │   - job_name: &apos;test_node_exporter&apos;</span><br><span class="line">  38   │</span><br><span class="line">  39   │     static_configs:</span><br><span class="line">  40   │         - targets: [&apos;10.239.157.129:9100&apos;]</span><br><span class="line">  41   │</span><br><span class="line">  42   │</span><br><span class="line">───────┴─────────────────────────────────────────────────────────────</span><br></pre></td></tr></table></figure></li></ul><h2 id="Exporte-local-metric-to-http-xxx-port-by-official-Node-Exporter-of-Prometheus"><a href="#Exporte-local-metric-to-http-xxx-port-by-official-Node-Exporter-of-Prometheus" class="headerlink" title="Exporte local metric to http:xxx:port by official Node Exporter of Prometheus"></a>Exporte local metric to http:xxx:port by official Node Exporter of Prometheus</h2><blockquote><p>OWCA is able to export metrics to file acceptable by node_exporter (with “textfile” collector enabled) – because we haven’t released owca-kafka-consumer yet (and we’re blocked because it has http endpoint and python server is not suitable for production usage), so before we publish it (that probably require rewrite to go and start new SDL process), the official way to getting data to Promethes is to use “LogStorage(overwrite=True, outputfile_name=’metrics.prom’)” with node_exporter  before Kubecon (ps. Kafka is still there for customer that need that) </p></blockquote><p><a href="https://github.com/prometheus/node_exporter" target="_blank" rel="noopener">https://github.com/prometheus/node_exporter</a></p><p>确定升级go version 到2.12xxx 不然build可能出错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/prometheus/node_exporter</span><br><span class="line">cd $&#123;GOPATH-$HOME/go&#125;/src/github.com/prometheus/node_exporter</span><br><span class="line">make</span><br><span class="line">./node_exporter &lt;flags&gt;</span><br></pre></td></tr></table></figure><p>build完成之后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./node_exporter --collector.textfile.directory  /home/li/myfolder/</span><br></pre></td></tr></table></figure><p>for example</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">li@yl-machine:~/Go/src/github.com/prometheus/node_exporter$ ./node_exporter --collector.textfile.directory /home/li/Go/test_node</span><br></pre></td></tr></table></figure><p>这里collector flag 设置为 textfile 这样可以load本地磁盘的文件</p><p>for example:</p><ul><li><p>Polan team OWCA monitor metrics to   <em>LogStorage(overwrite=True, outputfile_name=’metrics.prom’)</em>, 只要找到metric.prom 的local存储Path然后设置 <em>colletcor.textfile.directory</em> 为此Path 就可以源源不断将owca 暴露的数据push 到Promethus db</p></li><li><p>according to official example</p><ul><li><p>To atomically push completion time for a cron job:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo my_batch_job_completion_time $(date +%s) &gt; /path/to/directory/my_batch_job.prom.$$</span><br><span class="line">mv /path/to/directory/my_batch_job.prom.$$ /path/to/directory/my_batch_job.prom</span><br></pre></td></tr></table></figure></li><li><p>To statically set roles for a machine using labels:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &apos;role&#123;role=&quot;application_server&quot;&#125; 1&apos; &gt; /path/to/directory/role.prom.$$</span><br><span class="line">mv /path/to/directory/role.prom.$$ /path/to/directory/role.prom</span><br></pre></td></tr></table></figure></li></ul></li><li><p>if we save the role.prom to test_node folder, then</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">li@yl-machine:~/Go/src/github.com/prometheus/node_exporter$ ./node_exporter --collector.textfile.directory /home/li/Go/test_node</span><br></pre></td></tr></table></figure><p>  输出:</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">INFO[0000] Starting node_exporter (version=0.17.0, branch=master, revision=4e5c4d464fa67e9cdfd9858d2151bc99603b2bff)  source=&quot;node_expor</span><br><span class="line">INFO[0000] Build context (go=go1.12.4, user=li@yl-machine, date=20190418-09:08:01)  source=&quot;node_exporter.go:157&quot;</span><br><span class="line">INFO[0000] Enabled collectors:                           source=&quot;node_exporter.go:97&quot;</span><br><span class="line">INFO[0000]  - arp                                        source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - bcache                                     source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - bonding                                    source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - conntrack                                  source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - cpu                                        source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - cpufreq                                    source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - diskstats                                  source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - edac                                       source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - entropy                                    source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - filefd                                     source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - filesystem                                 source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - hwmon                                      source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - infiniband                                 source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - ipvs                                       source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - loadavg                                    source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - mdadm                                      source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - meminfo                                    source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - netclass                                   source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - netdev                                     source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - netstat                                    source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - nfs                                        source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - nfsd                                       source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - sockstat                                   source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - stat                                       source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - textfile                                   source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - time                                       source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - timex                                      source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - uname                                      source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - vmstat                                     source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - xfs                                        source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000]  - zfs                                        source=&quot;node_exporter.go:104&quot;</span><br><span class="line">INFO[0000] Listening on :9100                            source=&quot;node_exporter.go:170&quot;</span><br></pre></td></tr></table></figure></li></ul><p>now open the brower 可以看出在9100端口 <a href="http://10.239.157.129:9100/metrics" target="_blank" rel="noopener">http://10.239.157.129:9100/metrics</a>, 在browser可看到之前写入的role metric 已经从本地prom file expose to http server</p><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">process_virtual_memory_max_bytes -1</span><br><span class="line"># HELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served.</span><br><span class="line"># TYPE promhttp_metric_handler_requests_in_flight gauge</span><br><span class="line">promhttp_metric_handler_requests_in_flight 1</span><br><span class="line"># HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.</span><br><span class="line"># TYPE promhttp_metric_handler_requests_total counter</span><br><span class="line">promhttp_metric_handler_requests_total&#123;code=&quot;200&quot;&#125; 2</span><br><span class="line">promhttp_metric_handler_requests_total&#123;code=&quot;500&quot;&#125; 0</span><br><span class="line">promhttp_metric_handler_requests_total&#123;code=&quot;503&quot;&#125; 0</span><br><span class="line"># HELP role Metric read from /home/li/Go/test_node/role.prom</span><br><span class="line"># TYPE role untyped</span><br><span class="line">role&#123;role=&quot;application_server&quot;&#125; 1</span><br></pre></td></tr></table></figure></code></pre><p>这时候我们promtheous的configure file prometheus.yml 添加新的job-<em>target</em> 为<a href="http://10.239.157.129:9100" target="_blank" rel="noopener">http://10.239.157.129:9100</a><br>    就可以在Promethus的默认端口9090看到metric</p><pre><code>http://10.239.157.129:9090/graph</code></pre><h2 id="Prometheus-usage"><a href="#Prometheus-usage" class="headerlink" title="Prometheus usage"></a>Prometheus usage</h2><p>for example:</p><ul><li>the address  <a href="http://10.239.157.129:9090/graph" target="_blank" rel="noopener">http://10.239.157.129:9090/graph</a></li><li>see config <a href="http://10.239.157.129:9090/config" target="_blank" rel="noopener">http://10.239.157.129:9090/config</a></li><li>see target <a href="http://10.239.157.129:9090/targets" target="_blank" rel="noopener">http://10.239.157.129:9090/targets</a></li><li>show graph <a href="http://10.239.157.129:9090/graph" target="_blank" rel="noopener">http://10.239.157.129:9090/graph</a></li></ul><h2 id="Query-Promethus-data"><a href="#Query-Promethus-data" class="headerlink" title="Query Promethus data"></a>Query Promethus data</h2><ul><li>query all metric names</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(&apos;http://100.64.176.12:9090/api/v1/label/__name__/values&apos;)</span><br></pre></td></tr></table></figure><ul><li>query 1h data of matric</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = requests.get(&apos;http://100.64.176.12:9090/api/v1/query&apos;,params=&#123;&apos;query&apos;: metrixName+&apos;[1h]&apos;&#125;)</span><br></pre></td></tr></table></figure><ul><li>get label series of a specific matric</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = requests.get(&apos;http://100.64.176.12:9090/api/v1/series&apos;,params=&#123;&apos;match[]&apos;: metrixName&#125;)</span><br></pre></td></tr></table></figure><ul><li>query 1h data of specific matric and with specific label options</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res = requests.get(&apos;http://100.64.176.12:9090/api/v1/query&apos;,params=&#123;&apos;query&apos;: metrixName+&apos;&#123;&apos;+lablename+&apos;=&quot;&apos;+labelvalue+&apos;&quot;&#125;&apos;+&apos;[1h]&apos;&#125;)</span><br></pre></td></tr></table></figure><ul><li>query with <em>step</em> parameter, if (end-start)/step &gt; 110000, exceed the <em>maximum resolution</em> <a href="https://github.com/prometheus/prometheus/blob/91d7175eaac18b00e370965f3a8186cc40bf9f55/web/api/v1/api.go" target="_blank" rel="noopener">prometheus/web/api/v1/api.go</a>, prometheus will fail<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url = url + &apos;/api/v1/query_range&apos;</span><br><span class="line">params = &#123;&apos;query&apos;: query, &apos;start&apos;: start, &apos;end&apos;: end, &apos;step&apos;: step&#125;</span><br><span class="line">res = requests.get(url, params=params, timeout=timeout)</span><br></pre></td></tr></table></figure></li></ul><h2 id="Show-prometheus-in-Grafana"><a href="#Show-prometheus-in-Grafana" class="headerlink" title="Show prometheus in Grafana"></a>Show prometheus in Grafana</h2><p>grafana datasource add the url of prometheus</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Prometheus-start-by-docker&quot;&gt;&lt;a href=&quot;#Prometheus-start-by-docker&quot; class=&quot;headerlink&quot; title=&quot;Prometheus start by docker&quot;&gt;&lt;/a&gt;Promethe
      
    
    </summary>
    
    
      <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
      <category term="prometheus" scheme="http://yoursite.com/tags/prometheus/"/>
    
      <category term="grafana" scheme="http://yoursite.com/tags/grafana/"/>
    
      <category term="time-series" scheme="http://yoursite.com/tags/time-series/"/>
    
  </entry>
  
  <entry>
    <title>Setting SSL for Zookeeper</title>
    <link href="http://yoursite.com/2019/06/21/zookeeper-ssl/"/>
    <id>http://yoursite.com/2019/06/21/zookeeper-ssl/</id>
    <published>2019-06-21T05:13:59.000Z</published>
    <updated>2019-06-21T09:38:36.131Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Reference-Links"><a href="#Reference-Links" class="headerlink" title="Reference Links"></a>Reference Links</h3><ul><li>Download from: <a href="https://archive.apache.org/dist/zookeeper/" target="_blank" rel="noopener">https://archive.apache.org/dist/zookeeper/</a>,  stable version <strong>not</strong> support ssl, so please download <em>zookeeper-3.5.0-alpha/</em></li><li>Zookeeper working with Kazoo: <a href="https://medium.com/@md.tsai/%E7%82%BA-zookeeper-%E8%A8%AD%E5%AE%9A%E5%8A%A0%E5%AF%86%E9%80%A3%E7%B7%9A-11702097f859" target="_blank" rel="noopener">https://medium.com/@md.tsai/%E7%82%BA-zookeeper-%E8%A8%AD%E5%AE%9A%E5%8A%A0%E5%AF%86%E9%80%A3%E7%B7%9A-11702097f859</a>, mainly refer this page</li><li>Official guide: <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/ZooKeeper+SSL+User+Guide" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/ZOOKEEPER/ZooKeeper+SSL+User+Guide</a></li></ul><h3 id="Details-and-steps"><a href="#Details-and-steps" class="headerlink" title="Details and steps"></a>Details and steps</h3><h3 id="zookeeper-configure"><a href="#zookeeper-configure" class="headerlink" title="zookeeper configure"></a>zookeeper configure</h3><ul><li><p>start zookeeper <em>tar -zxvf zookeeper.tar.gz</em>, check status of  zookeeper by <em>bin/zkServer.sh status</em>, copy <em>conf/zoo.sample.cfg</em> to <em>conf/zoo.cfg</em>,zookeeper will auto read this file to start</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh start</span><br></pre></td></tr></table></figure></li><li><p>test the connection of zookeeper works</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkCli.sh -server localhost:2181</span><br></pre></td></tr></table></figure></li></ul><h3 id="zookeeper-with-SSL"><a href="#zookeeper-with-SSL" class="headerlink" title="zookeeper with SSL"></a>zookeeper with SSL</h3><ul><li><p>setting env variable under <em>bin/zkEnv.sh</em></p><ul><li><p>comment out the origin line <em>export SERVER_JVMFLAGS ….</em></p></li><li><p>add this for the new line - for the zookeeper <strong>server</strong></p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ZK_SERVER_SSL=<span class="string">"-Dzookeeper.serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.location=/home/li/Documents/zoo-ssl/ssl-conf/keystore.jks </span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.password=yourpass</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.location=/home/li/Documents/zoo-ssl/ssl-conf/keystore.jks</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.password=yourpass"</span></span><br><span class="line"><span class="built_in">export</span> SERVER_JVMFLAGS=<span class="string">"-Xmx<span class="variable">$&#123;ZK_SERVER_HEAP&#125;</span>m <span class="variable">$ZK_SERVER_SSL</span> <span class="variable">$SERVER_JVMFLAGS</span>"</span></span><br></pre></td></tr></table></figure></li><li><p>comment out the origin line <em>export CLIENT_JVMFLAGS …</em></p></li><li><p>add this for the new line - for the zookeeper <strong>client</strong></p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ZK_CLIENT_SSL=<span class="string">"-Dzookeeper.serverCnxnFactory=org.apache.zookeeper.server.NettyServerCnxnFactory</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.location=/home/li/Documents/zoo-ssl/ssl-conf/keystore.jks </span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.keyStore.password=yourpass</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.location=/home/li/Documents/zoo-ssl/ssl-conf/keystore.jks</span></span><br><span class="line"><span class="string">-Dzookeeper.ssl.trustStore.password=yourpass"</span></span><br><span class="line"><span class="built_in">export</span> CLIENT_JVMFLAGS=<span class="string">"-Xmx<span class="variable">$&#123;ZK_CLIENT_HEAP&#125;</span>m <span class="variable">$ZK_CLIENT_SSL</span> <span class="variable">$CLIENT_JVMFLAGS</span>"</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>add a <em>secureClientPort</em> for <em>conf/zoo.cfg</em></p><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secureClientPort=2281</span><br></pre></td></tr></table></figure></code></pre></li><li><p>restart the zookeeper by</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkServer.sh restart</span><br></pre></td></tr></table></figure></li><li><p>test the connection by</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/zkCli.sh -server 127.0.0.1:2281</span><br></pre></td></tr></table></figure><p>  now we use the <strong>secureClientPort</strong> 2281</p></li></ul><h3 id="generate-keys-of-jks-and-pem-format"><a href="#generate-keys-of-jks-and-pem-format" class="headerlink" title="generate keys of jks and pem format"></a>generate keys of jks and pem format</h3><ul><li><p>generate keystore.jks example</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkeypair -<span class="built_in">alias</span> name1 -keyalg RSA -keysize 2048 -keypass password -storepass password -validity 9999 -keystore keystore.jks -ext SAN=DNS:localhost,IP:127.0.0.1</span><br><span class="line"></span><br><span class="line">keytool -genkeypair -<span class="built_in">alias</span> zookeeper-ssl -keyalg RSA -keysize 2048 -keypass aaaaaa -storepass yourpass -validity yourpass -keystore keystore.jks -ext SAN=DNS:localhost,IP:127.0.0.1</span><br></pre></td></tr></table></figure><p>  or enter password with interation</p>  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -keyalg RSA -<span class="built_in">alias</span> zookeeper-ssl -keystore keystore.jks -validity 9999 -keysize 2048</span><br></pre></td></tr></table></figure><p>  then you can use the zookeeper ssl with this key, the <em>keypass</em> and <em>storepass</em> should be same one, otherwise it will use the storepass.</p></li><li><p>Since kazoo don’t support jks, we need to transfer x.jks to x.pkcs12, then to the x.pem</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore -srckeystore keystore.jks -destkeystore keystore.p12 -srcalias zookeeper-ssl -srcstoretype jks -deststoretype pkcs12</span><br></pre></td></tr></table></figure><p>  the source password is the password of x.jks, convert x.jks to x.pkcs12 by</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -importkeystore -srckeystore keystore.jks -destkeystore keystore.p12 -srcalias zookeeper-ssl -srcstoretype jks -deststoretype pkcs12</span><br></pre></td></tr></table></figure><p>  pay attention to the <em>srcalias</em></p><p>  convert x.pkcs12 to x.pem by</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -in keystore.p12 -out keystore.pem</span><br></pre></td></tr></table></figure></li><li><p>Kazoo : Kazoo implements the Zookeeper protocol in pure Python, so you don’t need any Python Zookeeper C bindings installed.</p><p>  <a href="https://kazoo.readthedocs.io/en/latest/api/client.html" target="_blank" rel="noopener">https://kazoo.readthedocs.io/en/latest/api/client.html</a></p></li></ul><pre><code><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zk = KazooClient(hosts=<span class="string">'IP:SEC_PORT'</span>, use_ssl=<span class="literal">True</span>, verify_certs=<span class="literal">False</span>, keyfile=<span class="string">'path/to/keystore.pem'</span>, certfile=<span class="string">'path/to/keystore.pem'</span>, keyfile_password=<span class="string">"password"</span>)</span><br></pre></td></tr></table></figure></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Reference-Links&quot;&gt;&lt;a href=&quot;#Reference-Links&quot; class=&quot;headerlink&quot; title=&quot;Reference Links&quot;&gt;&lt;/a&gt;Reference Links&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Download fro
      
    
    </summary>
    
    
      <category term="zookeeper" scheme="http://yoursite.com/tags/zookeeper/"/>
    
      <category term="ssl" scheme="http://yoursite.com/tags/ssl/"/>
    
  </entry>
  
  <entry>
    <title>kafka</title>
    <link href="http://yoursite.com/2019/06/21/kafka/"/>
    <id>http://yoursite.com/2019/06/21/kafka/</id>
    <published>2019-06-21T05:13:49.000Z</published>
    <updated>2019-06-21T05:15:30.356Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="kafka" scheme="http://yoursite.com/tags/kafka/"/>
    
      <category term="message queue" scheme="http://yoursite.com/tags/message-queue/"/>
    
      <category term="database" scheme="http://yoursite.com/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>Hexo Start</title>
    <link href="http://yoursite.com/2019/06/21/hello-world/"/>
    <id>http://yoursite.com/2019/06/21/hello-world/</id>
    <published>2019-06-21T04:10:07.335Z</published>
    <updated>2019-06-21T07:13:06.253Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p><h1 id="Best-Manaual-I-Think"><a href="#Best-Manaual-I-Think" class="headerlink" title="Best Manaual I Think"></a>Best Manaual I Think</h1><p><a href="https://linghucong.js.org/2016/04/15/2016-04-15-hexo-github-pages-blog/" target="_blank" rel="noopener">手把手教你使用Hexo + Github Pages搭建个人独立博客</a></p><h1 id="Yilia-Theme"><a href="#Yilia-Theme" class="headerlink" title="Yilia Theme"></a>Yilia Theme</h1><p><a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">Yilia github</a><br><a href="https://github.com/litten/BlogBackup" target="_blank" rel="noopener">Blog Backup</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
      <category term="start" scheme="http://yoursite.com/tags/start/"/>
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="yilia" scheme="http://yoursite.com/tags/yilia/"/>
    
  </entry>
  
</feed>
